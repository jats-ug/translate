# ATSでの種、静的な世界、そして動的な世界

(元記事は http://blog.steinwaywu.com/sorts-statics-and-dynamics-in-ats/ です)

これは私の指導教官である Xi による興味深い話です。
そして、そのアイデアをここに適切に記そうと努力しようと思います。

## 型システムの要約

型システムとは型に関する体系です。
それらは**基本型**、**複合型**、そして**基本型を使って複合型を構築するための規則**を持っています。
また型システムには他に、いくつかの規則を使って項や式の型をどのように決定するかのような、本質的な理論があります。
Applied Type System を表わす ATS は型システムです。
それは独自の基本型、複合型を表現する規則、そして多くの関連する理論を持ちます。

型システムには異なる種類があります。
複合型を表現するために基本型を使い、さらなる複合型を表現するために複合型を使うかもしれません。
これは階層的な構造を持っています。
それらは**階層的な型システム**であると言えるのです。
その他の型システムは階層を持ちません。
これは Martin-Lof の型理論のような**循環した定義**を含んでいます。
ATS はこの階層的な型システムを選択しています。
(しかし、私の指導教官は彼のアイデアを、循環した定義の体系がいくつかの点でより先進的であると表現しました。)

ATS には型の基礎的なレベルと、その基礎の上に2つの型のレベルがあります。
それらはそれぞれ、**種 (sorts)**、**静的な世界 (statics)**、と**動的な世界 (dynamics)** です。
種は基礎的な型で、静的な世界を表現したりコンストラクトしたりします。
そして静的な世界は、動的な世界で使われる複合型をコンストラクトするために使われます。

## 静的な世界 (Statics)

静的な世界の前に、型の基礎的なレベルである種について説明しましょう。
ATS の論文では、種は次のように定義されています:

![](img/sorts-statics-and-dynamics-in-ats/1.png)

![](img/sorts-statics-and-dynamics-in-ats/3.png) は基礎種を表わし、それらは `bool`, `addr`, `type`, `t@ype` のようなそれ以上分解できない種です。
また ![](img/sorts-statics-and-dynamics-in-ats/2.png) も種として定義されています。
それらは関数を表わす種として考えることができます。
しかし現実の ATS の静的な世界では、それまだサポートされていません。
なぜなら実際にはラムダ抽象と関数適用は存在しないからです。
**これらの種は、静的な項を表現したりコンストラクトしたりするのに使われます。**
項はラムダ項を参照していて、これは後のブログエントリで説明しようと思います。
私の理解では、**項は静的な世界と動的な世界の中心部分です。***
それは他のプログラミング言語でも同様でしょう。
それはプログラミング言語において、変数、命令文、関数、関数呼び出しなどのような構造的な部品を表わします。
型付き言語 (少なくとも ATS) では、**それぞれの項には型が割り当てられます。**
特にそれぞれの静的な項には、いくつかの規則を使って、種が割り当てられます。
これが「静的な項を表現したりコンストラクトするために種を使う」という意味です。

**静的な世界は、複合の静的な項を表現するための言語として考えることができます。**
その構文は論文で良く説明されていて、最初の構文は上記に示した種の構文です。
残りは以下のようなものです:

* 静的な項: ![](img/sorts-statics-and-dynamics-in-ats/4.png)
* 静的な変数コンテキスト: ![](img/sorts-statics-and-dynamics-in-ats/5.png)
* シグニチャ: ![](img/sorts-statics-and-dynamics-in-ats/6.png)
* 静的な置換: ![](img/sorts-statics-and-dynamics-in-ats/7.png)

静的な項は、型付きラムダ計算におけるラムダ項によく似ています。
![](img/sorts-statics-and-dynamics-in-ats/8.png) は変数です。
![](img/sorts-statics-and-dynamics-in-ats/9.png) はラムダ抽象で、関数を表わします。
![](img/sorts-statics-and-dynamics-in-ats/10.png) は関数適用もしくは関数呼び出しです。
唯一の違いは ![](img/sorts-statics-and-dynamics-in-ats/11.png) です。
それは関数適用の特別な種類で、静的な定数 ![](img/sorts-statics-and-dynamics-in-ats/12.png) を静的な項 ![](img/sorts-statics-and-dynamics-in-ats/13.png) に適用します。

静的な定数は `int(n)` のような**静的な定数コンストラクタ**や `+` 演算子のような**静的な定数関数**を含んでいます。
もしくはそれらを単に静的な定数関数と呼ぶこともできます。
それらは本質的に同じものだからです。

それらは両方ともラムダ抽象や関数 (もしくはより正確には ATS であらかじめ定義された関数) に分類できますが、ATS は実際の実装です。
もし純粋な型付きラムダ計算を使ってプラス演算子を作ろうとしたら、それは巨大な作業になるでしょう。
そこで ATS はそれらを分離された定義に展開します。
現時点で私はこの点を詳しく知りませんが、より詳しく学んだら後で説明できるかもしれません。
静的な定数に戻りましょう。
それらの定義はシグニチャのように表現されます。
最初の部分 ![](img/sorts-statics-and-dynamics-in-ats/15.png) はあらかじめ定義された基礎的な定義を含んでいます。
次の2つ目の部分は、種 ![](img/sorts-statics-and-dynamics-in-ats/18.png) の新しいシグニチャ ![](img/sorts-statics-and-dynamics-in-ats/17.png) を含めるために ![](img/sorts-statics-and-dynamics-in-ats/16.png) を拡張する拡張規則です。
静的な定数を表わす種と以前に定義された種の衝突を防ぐために、ATS では静的な定数を「sc種」と呼びます。
(ATS の静的な世界にはラムダ抽象と関数適用が存在します。
![](img/sorts-statics-and-dynamics-in-ats/19.png) の形で種を定義できるのです。
またそれを適用することもできます。)
もし実際の感覚を掴みたいのであれば、最後の例まで読み飛ばしてください。

## 動的な世界 (Dynamics)

動的な世界は証明とプログラムに関する全てです。
一言で言えば、動的な世界を表現したり動的な世界の使用を書いたりするために静的な世界を使うのとは対照的に、現実のプログラムをコンストラクトするために動的な世界を使います。
証明もまたプログラムですが、それらはなんらかの証明のための定理を生成します。
動的な世界は静的な世界と良く似ています。
**動的な項には型が割り当てられます。**
**これらの型は、種** `type` **(もしくは** `t@ype`**) の静的な項です。**
また動的な項、動的な値、変数コンテキスト、置換を表わす形式的な定義があります。
しかしこれは今の私には複雑すぎます。
後に解説できるかもしれません。
けれども「動的な値」が存在するわけではないのです。
私の知っている限りそれらは動的な項で、プログラミング言語の文法における末端のようにそれ以上分割できません。

## 例

```ats
datasort mylist =  
 | nil of ()
 | cons of (int, mylist)
stadef list = cons (1, nil())
```

この静的な例では、`mylist` という種を定義していて、これは論文での基礎種 ![](img/sorts-statics-and-dynamics-in-ats/20.png) に相当します。
`cons` はsc種 ![](img/sorts-statics-and-dynamics-in-ats/21.png) の静的な定数です。
`nil()` と `cons (1, nil())` は静的な定数適用で、種 `mylist` の静的な項として定義されています。
`list` は種 `mylist` の静的な項です。

この静的な定数は ![](img/sorts-statics-and-dynamics-in-ats/23.png) の代わりに、![](img/sorts-statics-and-dynamics-in-ats/22.png) の形を取るべきであることに注意してください。

```ats
fun myplus (a:int, b:int):int
```

この動的な例では、関数 `myplus` を定義していて、これは型 ![](img/sorts-statics-and-dynamics-in-ats/24.png) の動的な項です。
型 ![](img/sorts-statics-and-dynamics-in-ats/24.png) は種 `type` の静的な項です。
この静的な項は、![](img/sorts-statics-and-dynamics-in-ats/25.png) 記号の静的な定数を用いた静的な定数適用の形を取ります。
これは (種 `type` の) 静的な項を取り、(種 `type` の) 静的な項を生成する静的な定数です。
![](img/sorts-statics-and-dynamics-in-ats/25.png) は静的な構文における ![](img/sorts-statics-and-dynamics-in-ats/26.png) の要素として定義されています。
論文を参照してください。

## 参考文献

ATS の論文は [ここ](http://www.ats-lang.org/MYDATA/ATS-types03.pdf) から入手できます。
